# Git ????????

## ????(editting commits)

### ??????????

??????? `git commit -a` ??????¶¡Å£(changes)?????????????????????????ßª????? ???????????????????????`HEAD`????????¶≈???(commit):

```bash
(master)$ git show
```

????

```bash
$ git log -n1 -p
```

### ????????(commit message)ß’????

???????????(commit message)ß’???????????(commit)???????(push), ??????????????????????????(commit message):

```bash
$ git commit --amend
```

?????????????, ???????????????. ???????, ??????????????????????:

```bash
$ git commit --amend -m 'xxxxxxx'
```

??????????(push)???????(commit), ?????????????(commit)??????(force push), ???????????????

### ????(commit)????????????????

?????????????(commit)?????????

```bash
$ git commit --amend --author "New Authorname <authoremail@mydomain.com>"
```

??????????????????, ?¶œ? 'git filter-branch'??????.

### ??????????(commit)???????????

????????????????????(commit)???????????:

```bash
$ git checkout HEAD^ myfile
$ git add -A
$ git commit --amend
```

???????????????????????????(open patch)?????????????????????????????????????(force push)????????????????

### ???????????????????(commit)

??????????????????(pushed commits)???????????????????????????????????????????????????ßª?????®∞?????(pulled)???????????????????????????????????????????

```bash
$ git reset HEAD^ --hard
$ git push -f [remote] [branch]
```

??????????????, ?? Git ????(reset)????????????????????????(??????????Å£):

```
(my-branch*)$ git reset --soft HEAD@{1}

```

????????????????????. ????????????, ¶∑???????????? `git revert SHAofBadCommit`?? ?????????????(commit)??????????????????ß“Å£(changes)?? ????, ???????????????? rebase-safe ?? (???ª« ??????????????????????), ??????? `git push -f`?? ????, ??¶œ? [the above section](#deleteremove-last-pushed-commit)??

### ?????????(commit)

???????π◊???????????????????.

```bash
$ git rebase --onto SHA1_OF_BAD_COMMIT^ SHA1_OF_BAD_COMMIT
$ git push -f [remote] [branch]
```

????????? [????? rebase](#interactive-rebase) ?????ßª????????????(commit)??????????ß≥?

### ???????????????????(amended commit)?????????????

```bash
To https://github.com/yourusername/repo.git
! [rejected]        mybranch -> mybranch (non-fast-forward)
error: failed to push some refs to 'https://github.com/tanay1337/webmaker.org.git'
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Integrate the remote changes (e.g.
hint: 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
```

???, rebasing(??????)??????(amending)???????**?????(commit)??????**, ??????????????????????????????????????(commit)?????????????????(force push) (`-f`)?? ??? &ndash; _????_ ??????????????!

```bash
(my-branch)$ git push origin mybranch -f
```

??????, **????????**. ????????????(push)????????(commit)?????????????????????????????????ßª??°¬????°¬???????????????????????????ß”????????

### ???????????????????(hard reset)????????????????

?????????????? `git reset --hard`, ???????????????(commit), ??? Git ???????????????????????ùu??

```bash
(master)$ git reflog
```

???????????????(commit)???ß“?, ?????????????? ???????????????(commit)?? SHA???????????:

```bash
(master)$ git reset --hard SHA1234
```

????????????

## ???(Staging)

### ???????????????????????¶≈???(commit)

```bash
(my-branch*)$ git commit --amend

```

### ?????????????????????????????????????????

??????, ???????????????????????, ?????????:

```bash
$ git add --patch filename.x
```

`-p` ??ß’????????????? ??????? `s` ??????????(commit)?? ???, ??????????????, ??????????? ????????????, ??????:

```bash
$ git add -N filename.x
```

???, ??????? `e` ???????????????????ßµ???? `git diff --cached` ?????????ßª?????????ßª????????????????

### ????????????????Å£(changes)?????????(commit)??

`git add` ???????????????????. `git add -p` ????????????????????????.

### ???????????????¶ƒ??ó®??¶ƒ???????????????

????ß÷?????? ??????????????????? stash ¶ƒ????????? ???????(reset)???? pop ????? stashed ??????, ????? add ?????

```bash
$ git stash -k
$ git reset --hard
$ git stash pop
$ git add -A
```

## ¶ƒ???(Unstaged)??????

### ?????¶ƒ?????????????????°§??

```bash
$ git checkout -b my-branch
```

### ?????¶ƒ??????????????????????????

```bash
$ git stash
$ git checkout my-branch
$ git stash pop
```

### ??????????¶ƒ????Å£(uncommitted changes)

???????????????(origin)??????(local)?????ßª??(commit)????????

```bash
# one commit
(my-branch)$ git reset --hard HEAD^
# two commits
(my-branch)$ git reset --hard HEAD^^
# four commits
(my-branch)$ git reset --hard HEAD~4
# or
(master)$ git checkout -f
```

???????????????, ???????????????????:

```bash
$ git reset filename
```

### ???????ßª¶ƒ????????

??????????????????ß÷??????????????????????

???(checkout)??????????????????????

```bash
$ git checkout -p
# Answer y to all of the snippets you want to drop
```

???????????????? `stash`?? Stash ????????????????, ???®¥???????, ????????????????

```bash
$ git stash -p
# Select all of the snippets you want to save
$ git reset --hard
$ git stash pop
```

????, stash ??????????, ??? stash drop??

```bash
$ git stash -p
# Select all of the snippets you don't want to save
$ git stash drop
```

## ???(Branches)

### ???????????????????????????????????????

?????????????? `git reflog` ????????????¶ƒ?????(pull) ?? HEAD ?????

```bash
(master)$ git reflog
ab7555f HEAD@{0}: pull origin wrong-branch: Fast-forward
c5bc55a HEAD@{1}: checkout: checkout message goes here
```

???°¬?????????????(desired commit):

```bash
$ git reset --hard c5bc55a
```

??®¿?

### ??????????????(commit)??????????????????????

????????????(push)????????????

`git status` ???????????(ahead)?(origin)???????:

```bash
(my-branch)$ git status
# On branch my-branch
# Your branch is ahead of 'origin/my-branch' by 2 commits.
#   (use "git push" to publish your local commits)
#
```

????????:

```bash
(master)$ git reset --hard origin/my-branch
```

### ?????????????°§????????????????? master

?? master ?????????°§???????ß›????°§??,???? master ??:

```bash
(master)$ git branch my-branch
```

?? master ??????????????:

```bash
(master)$ git reset --hard HEAD^
```

`HEAD^` ?? `HEAD^1` ???ß’???????????????????`HEAD`??????????®¢?

????, ?????????? `HEAD^`, ????????????????(commit)?? hash(`git log` ??????)?? ??????????? hash?? ???`git push` ????????????

????, master ???????????????? hash ?`a13b85e`:

```bash
(master)$ git reset --hard a13b85e
HEAD is now at a13b85e
```

???(checkout)??????????????????:

```bash
(master)$ git checkout my-branch
```

### ????????????????? ref-ish ?????????

?????????????????????(???? working spike (see note)), ?ß‘??????????????????®≤?®¢?????, ???????????????????ú¢??????:

```bash
(solution)$ git add -A && git commit -m "Adding all changes from this spike into one big commit."
```

?????????????????????? (??????`feature`, ???? `develop`), ?????????????????????????????????????????????ß≥??

????????:

- ??? `solution`, ??????????? ???? `develop` ?????
- ??? `develop`, ????????????????????ßª?????

??????????????????????????????????????:

```bash
(develop)$ git checkout solution -- file1.txt
```

????????????????? `solution` ?????? `develop` ????:

```bash
# On branch develop
# Your branch is up-to-date with 'origin/develop'.
# Changes to be committed:
#  (use "git reset HEAD <file>..." to unstage)
#
#        modified:   file1.txt
```

???, ????????

Note: Spike solutions are made to analyze or solve the problem. These solutions are used for estimation and discarded once everyone gets clear visualization of the problem. \~ [Wikipedia](https://en.wikipedia.org/wiki/Extreme_programming_practices).

### ????????(commit)???????????????????ßª????°¬????????????

???????????`master`????? ???`git log`, ????????????????:

```bash
(master)$ git log

commit e3851e817c451cc36f2e6f3049db528415e3c114
Author: Alex Lee <alexlee@example.com>
Date:   Tue Jul 22 15:39:27 2014 -0400

    Bug #21 - Added CSRF protection

commit 5ea51731d150f7ddc4a365437931cd8be3bf3131
Author: Alex Lee <alexlee@example.com>
Date:   Tue Jul 22 15:39:12 2014 -0400

    Bug #14 - Fixed spacing on title

commit a13b85e984171c6e2a1729bb061994525f626d14
Author: Aki Rose <akirose@example.com>
Date:   Tue Jul 21 01:12:48 2014 -0400

    First commit
```

?????????? hash(commit hash)??? bug (`e3851e8` for #21, `5ea5173` for #14).

????, ?????`master`???????????????(`a13b85e`):

```bash
(master)$ git reset --hard a13b85e
HEAD is now at a13b85e
```

????, ????? bug #21 ????????????:

```bash
(master)$ git checkout -b 21
(21)$
```

????, ?????? _cherry-pick_ ??? bug #21 ?????????????? ????¶∆??????????(apply)?????(commit)?????????????(commit)??????? HEAD ???µµ

```bash
(21)$ git cherry-pick e3851e8
```

?????, ???????????????? ?¶Ã?[????? rebasing ??](#interactive-rebase) [**?????**](#merge-conflict) ??????.

????? ????? bug #14 ????????????, ?????`master`???

```bash
(21)$ git checkout master
(master)$ git checkout -b 14
(14)$
```

???, ? bug #14 ??? `cherry-pick`:

```bash
(14)$ git cherry-pick 5ea5173
```

### ???????????(upstream)????????????????

??????? github ??????(merge)????? pull request, ??????????? fork ??????????? ?????????????????????©Ç??, ???????????????????????????????????????????????????????ß≥?

```bash
$ git fetch -p
```

### ???ß≥????????????

???????????????, ???????????????????????ßª???????????????????????????? ????????????????????????????:

```bash
(master)$ git checkout -b my-branch
(my-branch)$ git branch
(my-branch)$ touch foo.txt
(my-branch)$ ls
README.md foo.txt
```

???????????????

```bash
(my-branch)$ git add .
(my-branch)$ git commit -m 'foo.txt added'
(my-branch)$ foo.txt added
 1 files changed, 1 insertions(+)
 create mode 100644 foo.txt
(my-branch)$ git log

commit 4e3cd85a670ced7cc17a2b5d8d3d809ac88d5012
Author: siemiatj <siemiatj@example.com>
Date:   Wed Jul 30 00:34:10 2014 +0200

    foo.txt added

commit 69204cdf0acbab201619d95ad8295928e7f411d5
Author: Kate Hudson <katehudson@example.com>
Date:   Tue Jul 29 13:14:46 2014 -0400

    Fixes #6: Force pushing after amending commits
```

?????????ß›????(master)?????????ß≥???????`my-branch`???

```bash
(my-branch)$ git checkout master
Switched to branch 'master'
Your branch is up-to-date with 'origin/master'.
(master)$ git branch -D my-branch
Deleted branch my-branch (was 4e3cd85).
(master)$ echo oh noes, deleted my branch!
oh noes, deleted my branch!
```

??????????????????`reflog`, ??????????????????õ•????(repo)???????ßÿ??????????

```
(master)$ git reflog
69204cd HEAD@{0}: checkout: moving from my-branch to master
4e3cd85 HEAD@{1}: commit: foo.txt added
69204cd HEAD@{2}: checkout: moving from master to my-branch
```

??????????????????????????????????? hash(commit hash)?????????????????????????????

```bash
(master)$ git checkout -b my-branch-help
Switched to a new branch 'my-branch-help'
(my-branch-help)$ git reset --hard 4e3cd85
HEAD is now at 4e3cd85 foo.txt added
(my-branch-help)$ ls
README.md foo.txt
```

??! ????????????????????? Git ?? `reflog` ?? rebasing ????????????????????

### ?????????????

???????????:

```bash
(master)$ git push origin --delete my-branch
```

???????:

```bash
(master)$ git push origin :my-branch
```

????????????:

```bash
(master)$ git branch -D my-branch
```

### ?????????????????????????(checkout)??????

????, ????????(fetch) ???ßŸ??:

```bash
(master)$ git fetch --all
```

???????????????`daves`?????????????`daves`

```bash
(master)$ git checkout --track origin/daves
Branch daves set up to track remote branch daves from origin.
Switched to a new branch 'daves'
```

(`--track` ?? `git checkout -b [branch] [remotename]/[branch]` ???ß’)

?????????????`daves`???????????, ?¶ ????(pushed)???????????????.

## Rebasing ????(Merging)

### ?????? rebase/merge

???????(merge)?? rebase ????????????, ??????????????????ß÷? rebase/merge?? Git ?????¶≤???????????????? HEAD ??????????? ORIG_HEAD ???????, ?????????????? rebase/merge ??????????????

```bash
(my-branch)$ git reset --hard ORIG_HEAD
```

### ????? rebase ??, ????????????(force push)

??????????????????ßª?Å£(changes)???????????????????????(force push)?? ????????(Fast forward)??????????? Git ???, ????????????Å£(changes)?????????(force push)??????????????? merge ??????, ?????? rebasing ?????????????????? ??????????(force push)??????????????˙ë???????????????????? rebase ????????????????Å£(changes)????????????, ????????????:

```bash
(master)$ git checkout my-branch
(my-branch)$ git rebase -i master
(my-branch)$ git checkout master
(master)$ git merge --ff-only my-branch
```

????, ?¶Ã? [this SO thread](http://stackoverflow.com/questions/11058312/how-can-i-use-git-rebase-without-requiring-a-forced-push).

### ????????(combine)??????(commit)

??????????????????????? `master` ?? pull-request?? ????????????????(commit)?????????????? _????_ ??(commit) ???????????????, ???????(reset)????(recommit)?? ?????(master)??????????????Å£?????????, ???:

```bash
(my-branch)$ git reset --soft master
(my-branch)$ git commit -am "New awesome feature"
```

????????????????, ???????????, ???????????? rebase (interactive rebase):

```bash
(my-branch)$ git rebase -i master
```

??????????????????? ?????®∞?????????`HEAD` ???? rebase?? ???ª«??????????????????(commit), ???????`HEAD\~2` ???? rebase?? ?????? 3 ????(commit), ?????`HEAD\~3`, ????

```bash
(master)$ git rebase -i HEAD~2
```

????????????? rebase ??????(interactive rebase command)??, ???????????????????????????:

```vim
pick a9c8a1d Some refactoring
pick 01b2fd8 New awesome feature
pick b729ad5 fixup
pick e3851e8 another fix

# Rebase 8074d12..b729ad5 onto 8074d12
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like "squash", but discard this commit's log message
#  x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
```

?????? `#` ??????ßÿ??????, ??????? rebase.

???????????¶ ??????????ß“???????ùI `pick`, ??????????????????????????????(commit)??

????, ??????? **???????????(first)????(commit),?????????????????????**, ??????????????(commit)??????????(commit) ??????? `f`:

```vim
pick a9c8a1d Some refactoring
pick 01b2fd8 New awesome feature
f b729ad5 fixup
f e3851e8 another fix
```

????????????ßª??(commit) **?????????????(commit)**, ?????????????(commit)?????????`r`????????????`s` ??? `f`:

```vim
pick a9c8a1d Some refactoring
pick 01b2fd8 New awesome feature
s b729ad5 fixup
s e3851e8 another fix
```

????????????????????????????????????(commit)??

```vim
Newer, awesomer features

# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# rebase in progress; onto 8074d12
# You are currently editing a commit while rebasing branch 'master' on '8074d12'.
#
# Changes to be committed:
#	modified:   README.md
#

```

????????, ?????????????????????:

```bash
(master)$ Successfully rebased and updated refs/heads/master.
```

#### ??????(merging)????

`--no-commit` ??ß‹??(merge)?????????, ??????????????????????? `no-ff` ?????????(feature branch)?????????????, ??????????????

```bash
(master)$ git merge --no-ff --no-commit my-branch
```

#### ???????????????????????(commit)

```bash
(master)$ git merge --squash my-branch
```

#### ????????(combine)¶ƒ?????(unpushed commit)

???????????????????????????ßﬁ?????????ß÷??????(commit)?????????????????(push)???????????????????????????????(commit)???????????

```bash
(master)$ git rebase -i @{u}
```

????????¶Õ?????? rebase(interactive rebase), ????ß‘??????(push)????(commit)?? ??????ß“?????? reorder/fix/squash ?????????

### ?????????????????(commit)?????(merge)????

??????????????????(commit)?????????(merge)???????????, ?????????ßª????? head(???¶ ? commits)???????? diff:

```bash
(master)$ git log --graph --left-right --cherry-pick --oneline HEAD...feature/120-on-scroll
```

???????????????????ßÿ???????????ß÷???????(commit), ??????????????(commit)???ß“? ???????????????:

```bash
(master)$ git log master ^feature/120-on-scroll --no-merges
```

### ????? rebase(interactive rebase)????????????

#### ??? rebase ?????????'noop'

???????????????:

```
noop
```

????¶∆???? rebase ???????????????????(commit)??, ???? _????(ahead)_ ???????? ????????:

- ????????(master)??????????
- rebase `HEAD\~2` ???????

#### ?ß‘???????

?????????????? rebase, ?????????????????

??????? `git status` ?????ßª????ß‘??:

```bash
(my-branch)$ git status
On branch my-branch
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   README.md
```

?????????????, `README.md` ?ß‘???? ????????????????????????:

```vim
   <<<<<<< HEAD
   some code
   =========
   some code
   >>>>>>> new-commit
```

?????????????????(?????, ???ßﬁ?`==`???`new-commit`????)??`HEAD` ??????????.

???????ßª???????????????????????????????(visual diff editor):

```bash
(master*)$ git mergetool -t opendiff
```

???????????ß‘??????????, `git add` ?Å£???(changed)???, ?????`git rebase --continue` ???? rebase??

```bash
(my-branch)$ git add README.md
(my-branch)$ git rebase --continue
```

????????????ß÷???????????????????????, ???????`git rebase --skip`??

?¶ ??????????????? rebase ????????? rebase ???????, ???????:

```bash
(my-branch)$ git rebase --abort
```

## ????(Miscellaneous Objects)

### ????????????

```bash
$ git clone --recursive git://github.com/foo/bar.git
```

???????????:

```bash
$ git submodule update --init --recursive
```

### ??????(tag)

```bash
$ git tag -d <tag_name>
$ git push <remote> :refs/tags/<tag_name>
```

### ???????????(tag)

????????????????????(tag), ???????????????: ????, ????????????????(unreachable tag):

```bash
$ git fsck --unreachable | grep tag
```

??????????(tag)?? hash??????? Git ?? [update-ref](http://git-scm.com/docs/git-update-ref):

```bash
$ git update-ref refs/tags/<tag_name> <hash>
```

????????(tag)????????????

### ?????????(patch)

???????? GitHub ?????????? pull request, ??????????????????????? fork, ???????????????(commit)????? `git am`?????????????, ????????????????(commit)???????????????????????°§?????????????

????????, ???????????¶Ã?[???????](#commit-wrong-author)?? ???, ???Å£, ??????????? pull request??

## ???????(Tracking Files)

### ???????????????????ß≥ß’?????????????

```bash
(master)$ git mv --force myfile MyFile
```

### ????? Git ??????????????????????

```bash
(master)$ git rm --cached log.txt
```

## ????(Configuration)

### ??????ßª Git ??????????(alias)

?? OS X ?? Linux ??, ??? Git ??????????????? `\~/.gitconfig`??????`[alias]` ??????????ßª??????(???ßª???????ß’?????)??????:

```vim
[alias]
    a = add
    amend = commit --amend
    c = commit
    ca = commit --amend
    ci = commit -a
    co = checkout
    d = diff
    dc = diff --changed
    ds = diff --staged
    f = fetch
    loll = log --graph --decorate --pretty=oneline --abbrev-commit
    m = merge
    one = log --pretty=oneline
    outstanding = rebase -i @{u}
    s = status
    unpushed = log @{u}
    wc = whatchanged
    wip = rebase -i @{u}
    zap = fetch -p
```

### ????????????(repository)?????????????

??????????????????????????????????????????????????????/??(push/pull)?????????Credential helper ?????

```bash
$ git config --global credential.helper cache
# Set git to use the credential memory cache
```

```bash
$ git config --global credential.helper 'cache --timeout=3600'
# Set the cache to timeout after 1 hour (setting is in seconds)
```

## ??????????????ßª??

??????????????? `????(reset)` ???ßª????, ????????????????, ?????????????????????????(commit)?????ßª???, ?????????®≤??, ????????????????????

????? `git reflog` ?????? `reflog` ???????????(the tip of a branch)???¶ ¶»??, ????????????ß“??¶ ¶«?????????®¢???????, ??? HEAD ????, ????????????????`reflog`??????????????????????????????????????? (???Ì‡????????????ß“????????????¶ ¶»??)??

```bash
(master)$ git reflog
0a2e358 HEAD@{0}: reset: moving to HEAD\~2
0254ea7 HEAD@{1}: checkout: moving from 2.2 to master
c10f740 HEAD@{2}: checkout: moving from master to 2.2
```

????? reflog ????? master ??????(checkout)?? 2.2 ?????????????? ????????????????(hard reset)??????????????????????????????????? `HEAD@{0}`???.

???????????ß≥?????(move back)????(commit), reflog ???????ß≥?????? master ????????(0254ea7)??

```bash
$ git reset --hard 0254ea7
```

?????? git reset ?????? master ???????? commit?????????????????????????????????????

## ???

- https://github.com/k88hudson/git-flight-rules/blob/master/README_zh-CN.md
- https://github.com/521xueweihan/git-tips
