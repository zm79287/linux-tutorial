---
title: Elastic ?????? Filebeat
date: 2017-01-03
categories:
- javatool
tags:
- java
- javatool
- log
- elastic
---

# Elastic ?????? Filebeat

## ???

Beats ?????????????????????????

Beats ??????????????? Elasticsearch ???? Logstash ??

<br><div align="center"><img src="https://www.elastic.co/guide/en/beats/libbeat/current/images/beats-platform.png"/></div><br>

Beats ?§Ø????????????????????????????????????

??????????§µ?

- **Packetbeat??**????????????????????§Û???????¨®??????????Ù¬??????????????
- **Filebeat??**???????????????????????
- **Metricbeat??**??????????????????????????????????????§Ö?????????????????
- **Winlogbeat??**??Windows????????

> **?¦Ï?**
>
> ???? Beats ???????¦Ï???[community-beats](https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html)
>
> **???**
>
> ?????????????????? FileBeat?????????????????? FileBeat ??

### FileBeat ??????

??? Logstash??FileBeat ????????????

???¦Ê¦Ë????????¨®???????????????? Filebeat ????????????§µ?????§Ø????????????????????????????¦Ë?¨¢?

Filebeat?????????÷Ïauditd??Apache??Nginx??System??MySQL???????????????????????????????????????????????????

FileBeat ????????????????¨À?FileBeat ??????? Logstash ??????????? Logstash ??????????????? FileBeat ?????????????????????????FileBeat ??????????????????????????

<br><div align="center"><img src="https://www.elastic.co/guide/en/beats/filebeat/current/images/filebeat.png"/></div><br>

## ???

Unix / Linux ????????????œ]??????????????¨¢?

```
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz
tar -zxf filebeat-6.1.1-linux-x86_64.tar.gz
```

> **?¦Ï?**
>
> ???????????¦Ï???[filebeat-installation](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html)

## ????

### ???????

????????????????`filebeat.yml` ?? filebeat ????????????????????¡¤????????????????????£??

Beat ??????§Ó????????????????? [YAML](http://www.yaml.org/) ?????FileBeat ??????????

filebeat.yml ?????????????

```yaml
filebeat:
  prospectors:
    - type: log
      paths:
        - /var/log/*.log
      multiline:
        pattern: '^['
        match: after
```

> **?¦Ï?**
>
> ???? filebeat ???????????¦Ï???[???? filebeat](https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html)
>
> ???? filebeat.yml ?????????????¦Ï???[filebeat.yml ??????](https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html)

### ?????????

#### filebeat.prospectors

?????????????????????????????????

**???**

```yaml
filebeat.prospectors:
- type: log
  enabled: true
  paths:
    - /var/log/*.log
```

#### output.elasticsearch

??????????? filebeat ????? elasticsearch ??????????????? output.elasticsearch ??

**???**

```yaml
output.elasticsearch:
  hosts: ["192.168.1.42:9200"]
```

#### output.logstash

??????????? filebeat ?? logstash????????????? logstash ????elasticsearch ??????????????? output.logstash??

> **???**
>
> ??????? elasticsearch ?????????????????? logstash ????????
>
> ??? logstash ?? filebeat ??????????? logstash ??????????????? FileBeat ?????????????????????????FileBeat ?????????????????????????????????????????????????????

**???**

```yaml
output.logstash:
  hosts: ["127.0.0.1:5044"]
```

??????????? logstash ????????????? logstash.conf??????? beats input ?????

```yaml
input {
  beats {
    port => 5044 # ????????? filebeat.yml ?§Ö??????
  }
}

# The filter part of this file is commented out to indicate that it is
# optional.
# filter {
#
# }

output {
  elasticsearch {
    hosts => "localhost:9200"
    manage_template => false
    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}" 
    document_type => "%{[@metadata][type]}" 
  }
}
```

#### setup.kibana

?????????? Filebeat ???? Kibana ???ÈÉ??????? setup.kibana ??

**???**

```yaml
setup.kibana:
  host: "localhost:5601"
```

#### setup.template.settings

?? Elasticsearch ?§µ?[???????](https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html)??????????¨²???????????¦Ç?????¦±?

?? Filebeat ?§µ?setup.template.settings ??????????????‰^

Filebeat ????????????????? Filebeat ??????????????????? filebeat.yml ????????§Ö?????????Filebeat????????? Elasticsearch ???????????‰^

??????????? Filebeat ??????????????????????????????????????????????????‰^????????????????????????????????????????

> **?¦Ï?**
>
> ???????????¦Ï???[filebeat-template](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html)
>
> **???**
>
> ??????????? Filebeat ????????§Ö??????????‡?¨À?

#### setup.dashboards

Filebeat ????????? Kibana ???‰^???????????????????????????? `filebeat- *`??????????????Kibana ?§³??????????????? `setup` ??????? `filebeat.yml` ?????????????????????

????? Kibana ?§Þ??? Filebeat ????????????? `filebeat.yml` ???????????????

```
setup.dashboards.enabled: true
```

> **?¦Ï?**
>
> ???????????¦Ï???[configuration-dashboards](https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html)
>

## ????

filebeat ????????????????????????

??????????

```bash
./filebeat COMMAND
```

> **?¦Ï?**
>
> ???????????¦Ï???[command-line-options](https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html)
>
> **???**
>
> ???????????????§Ò????????????????????????????????????¨À?????????????????????????????????????????????????????????????
>
> ??????????????????? run ???
>
> **???** ??????????????
>
> ```bash
> ./filebeat run -e -c filebeat.yml -d "publish"
> ./filebeat -e -c filebeat.yml -d "publish" # run ???????
> ```

## ???

Filebeat ????????????????ï…???????????????????????????????????????????????????????????§»???????????????????????Nginx??Apache2??MySQL ???

### ???????????

- ???? elasticsearch ?? kibana

```
output.elasticsearch:
  hosts: ["myEShost:9200"]
  username: "elastic"
  password: "elastic"
setup.kibana:
  host: "mykibanahost:5601"
  username: "elastic" 
  password: "elastic
```

> username ?? password ?????????????????????þŸ

- ?????????

???????????filebeat ??????????????‰^

```
./filebeat setup -e
```

- ??????

????????????????????????î•

```
./filebeat -e --modules system,nginx,mysql
```

> **?¦Ï?**
>
> ???????????¦Ï??? [???? filebeat ???](https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html) | [filebeat ??????](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html)

## ???

Filebeat ??????????????

harvester????????????????????????????§Ø??????????????????????????????

prospector????????? harvester ??????????????????????????????????????prospector ?????????¡¤?????????????????????

```yaml
filebeat.prospectors:
- type: log
  paths:
    - /var/log/*.log
    - /var/path2/*.log
```

Filebeat?????????????????????????????????§Ö???????????????? harvester ???????????????????????????????????§³?

Filebeat ????????????????›¥??????????§³???????????????????????¦Å??????????????????????

## ????

[Beats ??????](https://www.elastic.co/guide/en/beats/libbeat/current/index.html)

