# Mysql ???

## ???????

??? rpm ?????

centos ?? yum ??????????? mysql ????????????????????????? mysql ?? repo ????????

### ??? mysql yum ?

???????????https://dev.mysql.com/downloads/repo/yum/

??1?????? yum ?

```bash
$ wget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm
```

??2????? yum repo ????????? yum ????

```bash
$ rpm -ivh mysql80-community-release-el7-1.noarch.rpm
```

??§ß????

???? /etc/yum.repos.d/ ???????????? repo ???

```bash
$ ls | grep mysql
mysql-community.repo
mysql-community-source.repo
```

???? yum??

```bash
$ yum clean all
$ yum makecache
```

??3???? rpm ?????

```bash
$ yum search mysql | grep server
mysql-community-common.i686 : MySQL database common files for server and client
mysql-community-common.x86_64 : MySQL database common files for server and
mysql-community-test.x86_64 : Test suite for the MySQL database server
                       : administering MySQL servers
mysql-community-server.x86_64 : A very fast and reliable SQL database server
```

??? yum ??? mysql ?§Þ??????????

```
# ???????
/var/lib/mysql/
# ???????
/usr/share/mysql??mysql.server?????????????
# ???????
/usr/bin??mysqladmin mysqldump??????
# ???????
/etc/rc.d/init.d/????????????mysql??????
# ???????
/etc/my.cnf
```

### ??? mysql ??????

```bash
$ yum install mysql-community-server
```

### ???? mysql ????

```bash
# ???? mysql ????
systemctl start mysqld.service

# ????????
systemctl status mysqld.service

# ????????
systemctl enable mysqld
systemctl daemon-reload
```

### ??????????????

???????????

```bash
$ grep "password" /var/log/mysqld.log
2018-09-30T03:13:41.727736Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: %:lt+srWu4k1
```

???????

```bash
mysql -uroot -p<???????>
```

??????????????? mysql???????????????????????

```bash
ALTER user 'root'@'localhost' IDENTIFIED BY '???????';
```

???????????????§Ö????§³§Õ????????????????????????????????????????????????????

### ??????????

```sql
mysql> CREATE USER 'root'@'%' IDENTIFIED BY '???????';
mysql> GRANT ALL ON *.* TO 'root'@'%';
mysql> ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '???????';
mysql> FLUSH PRIVILEGES;
```

### ??????????

```
vim /etc/my.cnf
```

?? [mysqld] ??????? skip-grant-tables

????????????????????????Ñö????? root ?????????????????

??? `service mysqld restart`?????? mysql

## ????

### ????????

?????????????????? Mysql ??????????

- master ???192.168.8.10
- slave ???192.168.8.11

#### ???????????

??1???????????

??? `vi /etc/my.cnf` ??????????????

```ini
[mysqld]
server-id=1
log-bin=mysql-bin
```

- `server-id` - ?????? ID ???
- `log-bin` - ????????¡¤?????????????????????????mysql?????§Õ????

??2??????????

??? `vi /etc/my.cnf` ??????????????

```ini
[mysqld]
server-id=2
log-bin=mysql-bin
```

??3?????????????????????

```sql
mysql> CREATE USER 'sync'@'192.168.8.11' IDENTIFIED WITH mysql_native_password BY '????'; -- ???????
mysql> GRANT REPLICATION SLAVE ON *.* TO 'sync'@'192.168.8.11'; -- ???
mysql> FLUSH PRIVILEGES; -- ???????????
```

??4???????????

```sql
mysql> show master status;
+------------------+----------+--------------+---------------------------------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB                            | Executed_Gtid_Set |
+------------------+----------+--------------+---------------------------------------------+-------------------+
| mysql-bin.000001 |     4202 |              | mysql,information_schema,performance_schema |                   |
+------------------+----------+--------------+---------------------------------------------+-------------------+
1 row in set (0.00 sec)
```

??5????Slave?????????????????

`MASTER_LOG_FILE` ?? `MASTER_LOG_POS` ?????????? `show master status` ?????? `File` ?? `Position` ??????????

```sql
mysql> CHANGE MASTER TO
MASTER_HOST='192.168.8.10',
MASTER_USER='sync',
MASTER_PASSWORD='????',
MASTER_LOG_FILE='binlog.000001',
MASTER_LOG_POS=4202;

```

??6?????????????

```
mysql> show slave status\G;
```

?????????????????????? YES??????????????

- `Slave_IO_Running`
- `Slave_SQL_Running`

??7?????? slave ????

```
mysql> start slave;
```

#### ?????????????????????

?????????

??1???????????????????

```sql
mysql> flush tables with read lock;
```

??2??????????????????????????????????

```bash
$ mysqldump -uroot -p<????> test > test.sql
```

??3??????????????????

```bash
$ scp test.sql root@192.168.8.11:/root/
```

??4?????????

```mysql
mysql> unlock tables;
```

 ????????

??1???????slave

```mysql
mysql> stop slave;
```

??2??????????test

```mysql
mysql> create database test default charset utf8;
```

??3??????????

```bash
$ mysql -uroot -ptest123 cmdb<cmdb.sql 
```

??4??????????§Ú??????????? 

```mysql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| cmdb               |
| mysql              |
| performance_schema |
| test               |
+--------------------+
```

## ???

### ???????

```
CREATE USER 'username'@'host' IDENTIFIED BY 'password';
```

?????

- username???????????????
- host??????????????????????????????????????????? localhost?????????????????**????????????????**?????????????`%`
- password??????????????????????????????????????????????????????????

?????

```sql
CREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';
CREATE USER 'pig'@'192.168.1.101_' IDENDIFIED BY '123456';
CREATE USER 'pig'@'%' IDENTIFIED BY '123456';
CREATE USER 'pig'@'%' IDENTIFIED BY '';
CREATE USER 'pig'@'%';
```

### ???

????

```sql
GRANT privileges ON databasename.tablename TO 'username'@'host'
```

?????

- privileges????????????????`SELECT`??`INSERT`??`UPDATE`???????????????????????`ALL`
- databasename?????????
- tablename?????????????????????????????????????????????????`*`???????`*.*`

?????

```sql
GRANT SELECT, INSERT ON test.user TO 'pig'@'%';
GRANT ALL ON *.* TO 'pig'@'%';
GRANT ALL ON maindataplus.* TO 'pig'@'%';
```

???

?????????????????????????????????????????????????????????????????:

```sql
GRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;
```

### ???????

????:

```
REVOKE privilege ON databasename.tablename FROM 'username'@'host';
```

???:

privilege, databasename, tablename??????????

????:

```
REVOKE SELECT ON *.* FROM 'pig'@'%';
```

???:

????????????`'pig'@'%'`???????????????????????????`GRANT SELECT ON test.user TO 'pig'@'%'`?????????`REVOKE SELECT ON *.* FROM 'pig'@'%';`?????????????????? test ??????? user ???`SELECT` ??????????????????????`GRANT SELECT ON *.* TO 'pig'@'%';`??`REVOKE SELECT ON test.user FROM 'pig'@'%';`??????????????????? test ??????? user ???`Select`????

?????????????????`SHOW GRANTS FOR 'pig'@'%';` ????

### ???????????

```sql
SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');
```

???????????????:

```sql
SET PASSWORD = PASSWORD("newpassword");
```

?????

```sql
SET PASSWORD FOR 'pig'@'%' = PASSWORD("123456");
```

### ????????

Mysql ??????????? mysqldump ???þŸ

mysqldump ????????§Ö????????????????????????????§Ö???????›¥??????????????§³?

?????

??1??????????????

????

```
mysqldump -u <username> -p <database> [<table1> <table2> ...] > backup.sql
```

- username ????????
- dbname ?????????
- table1 ?? table2 ???????????????????????????????????????
- BackupName.sql ???????????????????????????????????????????¡¤?????????????????????????? sql ?????

??2?????????????

```
mysqldump -u <username> -p --databases <database1> <database2> ... > backup.sql
```

??3???????????????

```
mysqldump -u <username> -p -all-databases > backup.sql
```

?????

Mysql ?????????? mysqldump ???þŸ

????

```
mysql -u <username> -p <database> < backup.sql
```

### §Ø??

??1?????????? mysql

```bash
$ rpm -qa | grep -i mysql
perl-DBD-MySQL-4.023-6.el7.x86_64
mysql80-community-release-el7-1.noarch
mysql-community-common-8.0.12-1.el7.x86_64
mysql-community-client-8.0.12-1.el7.x86_64
mysql-community-libs-compat-8.0.12-1.el7.x86_64
mysql-community-libs-8.0.12-1.el7.x86_64
```

??2??§Ø?? mysql

```bash
$ yum remove mysql-community-server.x86_64
```

## ????

### JDBC ?? Mysql ?? CST ???§¿???????????? 14 ?? 13 §³?

**????**

??????§Õ›¥?? Timestamp ?????????????? 13 ??§³???

**???**

- ?? JDBC ?? MySQL ??????????????????????????????
- ?? MySQL ?? `time_zone` ?? `SYSTEM` ?????? `system_time_zone` ????§¿???????????????? `CST` ??? Java ??????????? `CST -0500` ???????????????????????????????`CST +0800`??????????????

> ???????????
>
> ??? `show variables like '%time_zone%';` ????? Mysql ????????
>
> ```
> mysql> show variables like '%time_zone%';
> +------------------+--------+
> | Variable_name    | Value  |
> +------------------+--------+
> | system_time_zone | CST    |
> | time_zone        | SYSTEM |
> +------------------+--------+
> ```

**???????**

?????

```
mysql> set global time_zone = '+08:00';
Query OK, 0 rows affected (0.00 sec)

mysql> set time_zone = '+08:00';
Query OK, 0 rows affected (0.00 sec)
```

??????

??? `my.cnf` ??????? `[mysqld]` ???????? `default-time-zone = '+08:00'` ???????????

## ?¦Ï?????

- https://www.cnblogs.com/xiaopotian/p/8196464.html
- https://www.cnblogs.com/bigbrotherer/p/7241845.html
- https://blog.csdn.net/managementandjava/article/details/80039650
- http://www.manongjc.com/article/6996.html
- https://www.cnblogs.com/xyabk/p/8967990.html
- [MySQL 8.0?????Master-Slave??????](https://blog.csdn.net/zyhlwzy/article/details/80569422)

## :door: ??????

| [????????ùr](https://github.com/dunwu/blog) | [??????????](https://github.com/dunwu/db-tutorial/codes) |
