# Gitlab ???

> ??????
>
> OS: CentOS7

<!-- TOC depthFrom:2 depthTo:3 -->

- [??? gitlab](#???-gitlab)
    - [???ëµ? gitlab](#???ëµ?-gitlab)
    - [Docker ??? gitlab](#docker-???-gitlab)
- [??? gitlab-ci-multi-runner](#???-gitlab-ci-multi-runner)
    - [???ëµ? gitlab-ci-multi-runner](#???ëµ?-gitlab-ci-multi-runner)
    - [Docker ??? gitlab-ci-multi-runner](#docker-???-gitlab-ci-multi-runner)
- [????????](#????????)
    - [???????](#???????)
- [gitlab ????](#gitlab-????)
- [????????](#????????)

<!-- /TOC -->

## ??? gitlab

### ???ëµ? gitlab

??????????????https://about.gitlab.com/install/ ????????????????·Ú??

<br><div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20190129155838.png"/></div><br>

?? CentOS7 ?????

#### ???????????????

??????????????? HTTP ?? SSH

```
sudo yum install -y curl policycoreutils-python openssh-server
sudo systemctl enable sshd
sudo systemctl start sshd
sudo firewall-cmd --permanent --add-service=http
sudo systemctl reload firewalld
```

??? Postfix ????? Gitlab ????????????

```
sudo yum install postfix
sudo systemctl enable postfix
sudo systemctl start postfix
```

#### ??? Gitlab yum ????????

??? Gitlab yum ???

```
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
```

??? yum ??? gitlab-ce

```
sudo EXTERNAL_URL="http://gitlab.example.com" yum install -y gitlab-ce
```

????????????????? root ??????§Ö??????????????¦Ï???[documentation for detailed instructions on installing and configuration](https://docs.gitlab.com/omnibus/README.html#installation-and-configuration-using-omnibus-package)

### Docker ??? gitlab

???????

```
docker pull docker.io/gitlab/gitlab-ce
```

????

```
docker run -d \
    --hostname gitlab.zp.io \
    --publish 8443:443 --publish 80:80 --publish 2222:22 \
    --name gitlab \
    --restart always \
    --volume $GITLAB_HOME/config:/etc/gitlab \
    --volume $GITLAB_HOME/logs:/var/log/gitlab \
    --volume $GITLAB_HOME/data:/var/opt/gitlab \
    gitlab/gitlab-ce
```

<br><div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20190131150515.png"/></div><br>

## ??? gitlab-ci-multi-runner

> ?¦Ï???https://docs.gitlab.com/runner/install/

### ???ëµ? gitlab-ci-multi-runner

#### ????

```
sudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
```

#### ??????????

```
sudo chmod +x /usr/local/bin/gitlab-runner
```

#### ???????? Docker????? Docker????????

```
curl -sSL https://get.docker.com/ | sh
```

#### ???? CI ???

```
sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
```

#### ?????????????

```
sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
sudo gitlab-runner start
```

#### ??? Runner

??1?????????

```
sudo gitlab-runner register
```

??2?????? Gitlab URL ?? ????

URL ??????????? Gitlab ?? Runner ???????????

<br><div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20190129163100.png"/></div><br>

```
Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )
https://gitlab.com

Please enter the gitlab-ci token for this runner
xxx
```

??3?????? Runner ??????

```
 Please enter the gitlab-ci description for this runner
 [hostame] my-runner
```

??4?????? Runner ??????

```
 Please enter the gitlab-ci tags for this runner (comma separated):
 my-tag,another-tag
```

??5?????? Runner ?????

```
 Please enter the executor: ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell:
 docker
```

???????? Docker ???????????????????????? `.gitlab-ci.yml` ????§Õ??????

```
 Please enter the Docker image (eg. ruby:2.1):
 alpine:latest
```

### Docker ??? gitlab-ci-multi-runner

???????

```
docker pull docker.io/gitlab/gitlab-runner
```

????

```
docker run -d --name gitlab-runner --restart always \
   -v /srv/gitlab-runner/config:/etc/gitlab-runner \
   -v /var/run/docker.sock:/var/run/docker.sock \
   gitlab/gitlab-runner:latest
```

## ????????

??????????????

```
sudo mkdir -p /etc/gitlab/ssl
sudo chmod 700 /etc/gitlab/ssl
```

### ???????

#### ???? Private Key

```
sudo openssl genrsa -des3 -out /etc/gitlab/ssl/gitlab.domain.com.key 2048
```

?????????????????

#### ???? Certificate Request

```
sudo openssl req -new -key /etc/gitlab/ssl/gitlab.domain.com.key -out /etc/gitlab/ssl/gitlab.domain.com.csr
```

????????????????

```
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:JS
Locality Name (eg, city) [Default City]:NJ
Organization Name (eg, company) [Default Company Ltd]:xxxxx
Organizational Unit Name (eg, section) []:
Common Name (eg, your name or your server's hostname) []:gitlab.xxxx.io
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
```

#### ??? Private Key ?§Ö????????

```
sudo cp -v /etc/gitlab/ssl/gitlab.domain.com.{key,original}
sudo openssl rsa -in /etc/gitlab/ssl/gitlab.domain.com.original -out /etc/gitlab/ssl/gitlab.domain.com.key
sudo rm -v /etc/gitlab/ssl/gitlab.domain.com.original
```

#### ???????

```
sudo openssl x509 -req -days 1460 -in /etc/gitlab/ssl/gitlab.domain.com.csr -signkey /etc/gitlab/ssl/gitlab.domain.com.key -out /etc/gitlab/ssl/gitlab.domain.com.crt
```

#### ?????????????

```
sudo rm -v /etc/gitlab/ssl/gitlab.domain.com.csr
```

#### ??????????

```
sudo chmod 600 /etc/gitlab/ssl/gitlab.domain.com.*
```

## gitlab ????

```
sudo vim /etc/gitlab/gitlab.rb
external_url 'https://gitlab.domain.com'
```

#### gitlab ??? https??

```
nginx['redirect_http_to_https'] = true
```

#### gitlab ci ??? https??

```
ci_nginx['redirect_http_to_https'] = true
```

#### ??????ùz gitlab ????

```
sudo cp /etc/gitlab/ssl/gitlab.domain.com.crt /etc/gitlab/trusted-certs/
```

#### gitlab ????????+?????

```
sudo gitlab-ctl reconfigure
sudo gitlab-ctl restart
```


### ??????? SSH key

1. ??? Gitlab ??????????????????? SSH ??????Github ????????

2. ??? Gitlab

3. ?? **Profile settings**.

<br><div align="center"><img src="https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings.png"/></div><br>

4. ????? **SSH keys** tab ?

<br><div align="center"><img src="https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys.png"/></div><br>

5. ?????? SSH ???????? Key ?????

<br><div align="center"><img src="https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_paste_pub.png"/></div><br>

6. ?????????????????????

<br><div align="center"><img src="https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_title.png"/></div><br>

7. ??? **Add key** ?? SSH ??????? GitLab

<br><div align="center"><img src="https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_single_key.png"/></div><br>

### ???????

<br><div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20190131150658.png"/></div><br>

??????????????? Create project ??????? Gitlab ?????????

<br><div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20190131150759.png"/></div><br>

### ????????????

??????? SSH ?? HTTPS ??????????????????? SSH??

??????????????????????? `git clone <url>`

<br><div align="center"><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1548919326929.png"/></div><br>

### ???? Issue

???¦Å?? **Project??s Dashboard** > **Issues** > **New Issue** ??????? Issue

<br><div align="center"><img src="https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_tracker_list.png"/></div><br>

????????????? issue

<br><div align="center"><img src="https://docs.gitlab.com/ce/user/project/issues/img/new_issue.png"/></div><br>

??¦Ä??? issue ?§µ???? **New Issue** ??? issue

<br><div align="center"><img src="https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_open_issue.png"/></div><br>

???????????? issue

<br><div align="center"><img src="https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_projects_dashboard.png"/></div><br>

??? issue ?????? issue

<br><div align="center"><img src="https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_issue_board.png"/></div><br>

## ????????

- **????**
  - [?????????????????????](https://github.com/dunwu/OS)
