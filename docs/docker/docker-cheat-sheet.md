# Docker Cheat Sheet

> ?????????????[Docker Cheat Sheet](https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn)

<!-- TOC depthFrom:2 depthTo:2 -->

- [????(Container)](#????container)
- [????(Images)](#????images)
- [????(Networks)](#????networks)
- [??????????(Registry & Repository)](#??????????registry--repository)
- [Dockerfile](#dockerfile)
- [??(Layers)](#??layers)
- [????(Links)](#????links)
- [???(Volumes)](#???volumes)
- [??????(Exposing ports)](#??????exposing-ports)
- [??????](#??????)
- [???(Security)](#???security)
- [ß≥???](#ß≥???)
- [?¶œ?????](#?¶œ?????)

<!-- /TOC -->

## ????(Container)

[???? Docker ???????????](http://etherealmind.com/basics-docker-containers-hypervisors-coreos/)?????? (Container) ???????? (Virtual Machine) ??????????????

### ????????

- [`docker create`](https://docs.docker.com/engine/reference/commandline/create) ????????????????????
- [`docker rename`](https://docs.docker.com/engine/reference/commandline/rename/) ????????????????
- [`docker run`](https://docs.docker.com/engine/reference/commandline/run) ???????????????????????
- [`docker rm`](https://docs.docker.com/engine/reference/commandline/rm) ?????????
  - ???????????????ß÷?????????????? `-f` ??????Docker ???? `SIGKILL` ??????????
- [`docker update`](https://docs.docker.com/engine/reference/commandline/update/) ??????????????????
- `docker container prune` ????????ß’????????????????

???????????????¶ ??????????????????????????????????????????????????ÿb???????ßµ????????? `docker run -td container_id` ???˛ü??? `-t` ?????????? pseudo-TTY ????`-d` ????????????????????????????????????????????????? ID????

????????????????????????? `docker run --rm` ????????????????????

????????????????? (host) ?????? Docker ???????????? `docker run -v $HOSTDIR:$DOCKERDIR`????? [???(Volumes)](#???volumes) ????

?????????????????????????????????????????????????? `-v` ????????? `docker rm -v`??

?? Docker 1.10 ?????????????????????? [???????](https://docs.docker.com/engine/admin/logging/overview/)??????????????????®¢????????? `docker run --log-driver=syslog` ?????????????ó§????????? `syslog`????

### ????????

- [`docker start`](https://docs.docker.com/engine/reference/commandline/start) ????????????????
- [`docker stop`](https://docs.docker.com/engine/reference/commandline/stop) ???????ß÷???????
- [`docker restart`](https://docs.docker.com/engine/reference/commandline/restart) ??????????
- [`docker pause`](https://docs.docker.com/engine/reference/commandline/pause/) ????????ß÷???????????????????????
- [`docker unpause`](https://docs.docker.com/engine/reference/commandline/unpause/) ???????????????
- [`docker wait`](https://docs.docker.com/engine/reference/commandline/wait) ????????????????ß÷????????????
- [`docker kill`](https://docs.docker.com/engine/reference/commandline/kill) ???????ß÷????????? SIGKILL ??˛ü
- [`docker attach`](https://docs.docker.com/engine/reference/commandline/attach) ??????????ß÷???????

??????????????? (ports) ???????????????? [??????](#??????exposing-ports) ????

???? Docker ?????????????????????? [????](http://container42.com/2014/09/30/docker-restart-policies/)??

#### CPU ????

????????? CPU ????????????????????????????????????

???Ì‡????????? [`cpu-shares`](https://docs.docker.com/engine/reference/run/#/cpu-share-constraint)??????????????ß÷???? -- 1024 ??? 100% CPU???????????????????????? CPU ???? 50%???????????? 512??

```
docker run -ti --c 512 agileek/cpuset-test
```

???????????? <https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/#_cpu>??

??? [`cpuset-cpus`](https://docs.docker.com/engine/reference/run/#/cpuset-constraint) ???????? CPU ????

```
docker run -ti --cpuset-cpus=0,4,6 agileek/cpuset-test
```

????? <https://agileek.github.io/docker/2014/08/06/docker-cpuset/> ??????????????ßª??????????

???Docker ?????????????? **????** ??? CPU -- ????????????????????????? <https://github.com/docker/docker/issues/20770> ???????????

#### ???????

????????? Docker ???? [???????](https://docs.docker.com/engine/reference/run/#/user-memory-constraints)??

```
docker run -it -m 300M ubuntu:14.04 /bin/bash
```

#### ????(Capabilities)

Linux ?? Capability ?????????? `cap-add` ?? `cap-drop` ???®¢?????? <https://docs.docker.com/engine/reference/run/#/runtime-privilege-and-linux-capabilities> ???????????????????????????

???????????? FUSE ????????????????? `--cap-add` ?? `--device` ????

```
docker run --rm -it --cap-add SYS_ADMIN --device /dev/fuse sshfs
```

?????????ıÙ?????????

```
docker run -it --device=/dev/ttyUSB0 debian bash
```

??????????ıÙ?????????

```
docker run -it --privileged -v /dev/bus/usb:/dev/bus/usb debian bash
```

?ß€????????????????????? [????](https://docs.docker.com/engine/reference/run/#/runtime-privilege-and-linux-capabilities)??

### ???

- [`docker ps`](https://docs.docker.com/engine/reference/commandline/ps) ???????ß÷???????????
- [`docker logs`](https://docs.docker.com/engine/reference/commandline/logs) ???????ßÿ??????????????????????????????????????? 1.10 ?ßµ??????? `json-file` ?? `journald`????
- [`docker inspect`](https://docs.docker.com/engine/reference/commandline/inspect) ???????????????????????? IP ???????
- [`docker events`](https://docs.docker.com/engine/reference/commandline/events) ???????ß›????? (events)??
- [`docker port`](https://docs.docker.com/engine/reference/commandline/port) ???????????????
- [`docker top`](https://docs.docker.com/engine/reference/commandline/top) ???????ß›??????
- [`docker stats`](https://docs.docker.com/engine/reference/commandline/stats) ????????????????????????
- [`docker diff`](https://docs.docker.com/engine/reference/commandline/diff) ????????????ß’????????????

`docker ps -a` ????????????????????????ß‹????????

`docker stats --all` ??????????????????????????????ß÷???????

### ???? / ????

- [`docker cp`](https://docs.docker.com/engine/reference/commandline/cp) ??????????????????¡Ÿ???????????
- [`docker export`](https://docs.docker.com/engine/reference/commandline/export) ??????????????????˘r????? (tarball archive stream) ????????????? (STDOUT)??

### ???????

- [`docker exec`](https://docs.docker.com/engine/reference/commandline/exec) ??????????????˛ü
  - ???Ì‡???????????ß÷? `foo` ???????????? (attach) ???????? Shell ?????`docker exec -it foo /bin/bash`??

## ????(Images)

?????? [Docker ?????????](https://docs.docker.com/engine/understanding-docker/#how-does-a-docker-image-work)??

### ????????

- [`docker images`](https://docs.docker.com/engine/reference/commandline/images) ?????ß‡???
- [`docker import`](https://docs.docker.com/engine/reference/commandline/import) ??˘r???????????
- [`docker build`](https://docs.docker.com/engine/reference/commandline/build) ?? Dockerfile ????????
- [`docker commit`](https://docs.docker.com/engine/reference/commandline/commit) ???????????????????????????????????????
- [`docker rmi`](https://docs.docker.com/engine/reference/commandline/rmi) ???????
- [`docker load`](https://docs.docker.com/engine/reference/commandline/load) ???????? (STDIN) ????˘r?? (tar archive) ??????????????????? (tags, 0.7 ??)??
- [`docker save`](https://docs.docker.com/engine/reference/commandline/save) ??????????˘r????????????????? (STDOUT)?????????ß÷?????????∑⁄ (parent layers, tags, versions, 0.7 ??)??

### ???????

- [`docker history`](https://docs.docker.com/engine/reference/commandline/history) ???????????????
- [`docker tag`](https://docs.docker.com/engine/reference/commandline/tag) ??????????????????????????????

### ????

?????????? `docker rmi` ?????????????????????ß⁄???? [docker-gc](https://github.com/spotify/docker-gc) ????????????????????????????????ßª??????¶ ????????????Docker 1.13 ????? `docker image prune` ??????¶ƒ???????¶Ã? [????](#????)??

### ???? / ???ùÿ??

??????ßﬁ??????

```
docker load < my_image.tar.gz
```

??????ß‡???

```
docker save my_image:my_tag | gzip > my_image.tar.gz
```

### ???? / ????????

??????ß÷???????????

```
cat my_container.tar.gz | docker import - my_image:my_tag
```

??????????????

```
docker export my_container | gzip > my_container.tar.gz
```

### ????????????? ?? ??????????????????? ????

??? `load` ????????????????????????????????????????????
??? `import` ????????????????????????????????????????????????????????? `load` ????????????ß≥??

## ????(Networks)

Docker ??? [????](https://docs.docker.com/engine/userguide/networking/) ??????????????????????????????????????????????? [???????](https://docs.docker.com/engine/userguide/networking/work-with-networks/) ???????????????ÿh?????????? Docker ??????????°¬?????

### ????????

- [`docker network create`](https://docs.docker.com/engine/reference/commandline/network_create/)
- [`docker network rm`](https://docs.docker.com/engine/reference/commandline/network_rm/)

### ???????

- [`docker network ls`](https://docs.docker.com/engine/reference/commandline/network_ls/)
- [`docker network inspect`](https://docs.docker.com/engine/reference/commandline/network_inspect/)

### ????????

- [`docker network connect`](https://docs.docker.com/engine/reference/commandline/network_connect/)
- [`docker network disconnect`](https://docs.docker.com/engine/reference/commandline/network_disconnect/)

????? [???????? IP ???](https://blog.jessfraz.com/post/ips-for-all-the-things/)??

```
# ?????????????????????????????????
docker network create --subnet 203.0.113.0/24 --gateway 203.0.113.254 iptastic

# ????????????????Ì‡??????? Nginx ????????? IP
$ docker run --rm -it --net iptastic --ip 203.0.113.2 nginx

# ???????????? CURL ??????? IP??????? IP ???????
$ curl 203.0.113.2
```

## ??????????(Registry & Repository)

??? (repository) ?? _???ß€?(hosted)_ ???????????? (tagged images) ??????????????????????????????

??????? (registry) ???? _?ß€????(host)_ -- ????õ•????? HTTP API????? [????????????????](https://docs.docker.com/engine/tutorials/dockerrepos/)??

Docker ????ß€???????? [???????](https://hub.docker.com/)???????????????????????????????????????? [????ß‹??????????](https://titanous.com/posts/docker-insecurity)??????????????????????????????????????

- [`docker login`](https://docs.docker.com/engine/reference/commandline/login) ???????????
- [`docker logout`](https://docs.docker.com/engine/reference/commandline/logout) ???????????
- [`docker search`](https://docs.docker.com/engine/reference/commandline/search) ???????????????
- [`docker pull`](https://docs.docker.com/engine/reference/commandline/pull) ???????????????????
- [`docker push`](https://docs.docker.com/engine/reference/commandline/push) ???????????????????

### ??????????

???????? [docker distribution](https://github.com/docker/distribution) ???????????????????????? [??????? (local deploy)](https://github.com/docker/docker.github.io/blob/master/registry/deploying.md) ??????

????????????????? [Google+ Group](https://groups.google.com/a/dockerproject.org/forum/#!forum/distribution)??

## Dockerfile

??????? `docker build` ???Docker ??????? [???????](https://docs.docker.com/engine/reference/builder/) ???? Docker ?????????????? `docker commit`??

???????ßª??ß’ Dockerfile ???????????????????????????????U

- ?????????? [jEdit](http://jedit.org)????????????????? Dockerfile [?????????](https://github.com/wsargent/jedit-docker-mode)??
- [Sublime Text 2](https://packagecontrol.io/packages/Dockerfile%20Syntax%20Highlighting)
- [Atom](https://atom.io/packages/language-docker)
- [Vim](https://github.com/ekalinin/Dockerfile.vim)
- [Emacs](https://github.com/spotify/dockerfile-mode)
- [TextMate](https://github.com/docker/docker/tree/master/contrib/syntax/textmate)
- ???????????? [Docker ???? IDE](https://domeide.github.io/)

### ???

- [.dockerignore](https://docs.docker.com/engine/reference/builder/#dockerignore-file)
- [FROM](https://docs.docker.com/engine/reference/builder/#from) ??????????????????? (Base Image)??
- [MAINTAINER (deprecated - use LABEL instead)](https://docs.docker.com/engine/reference/builder/#maintainer-deprecated) ???????????????????¶±?
- [RUN](https://docs.docker.com/engine/reference/builder/#run) ??????????????????????????????˛ü
- [CMD](https://docs.docker.com/engine/reference/builder/#cmd) ?????????????????˛ü
- [EXPOSE](https://docs.docker.com/engine/reference/builder/#expose) ??? Docker ???????????????????????????????????????????????????????
- [ENV](https://docs.docker.com/engine/reference/builder/#env) ?????????????
- [ADD](https://docs.docker.com/engine/reference/builder/#add) ???????????????????????????ß≥???????ßπ???????? `COPY` ???? `ADD`??
- [COPY](https://docs.docker.com/engine/reference/builder/#copy) ???????????ß⁄?????????ß≥????????? ROOT ?????????????????? USER / WORKDIR ???????????????????????????????`chown`????`ADD` ????????
- [ENTRYPOINT](https://docs.docker.com/engine/reference/builder/#entrypoint) ?????????????ß÷??
- [VOLUME](https://docs.docker.com/engine/reference/builder/#volume) ?????????????????? (mount point) ???????????????????????
- [USER](https://docs.docker.com/engine/reference/builder/#user) ?????????? RUN / CMD / ENTRYPOINT ????????????
- [WORKDIR](https://docs.docker.com/engine/reference/builder/#workdir) ???®¥????? (working directory)??
- [ARG](https://docs.docker.com/engine/reference/builder/#arg) ???????? (build-time) ??????
- [ONBUILD](https://docs.docker.com/engine/reference/builder/#onbuild) ????????????????????????????????????????????????
- [STOPSIGNAL](https://docs.docker.com/engine/reference/builder/#stopsignal) ?????????????????????????????????? (system call signal)??
- [LABEL](https://docs.docker.com/config/labels-custom-metadata/) ???????????? (key/value metadata) ????????????????????????

### ???

- [Flux7's Dockerfile Tutorial](http://flux7.com/blogs/docker/docker-tutorial-series-part-3-automation-is-the-word-using-dockerfile/)

### ????

- [Examples](https://docs.docker.com/engine/reference/builder/#dockerfile-examples)
- [Best practices for writing Dockerfiles](https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/)
- [Michael Crosby](http://crosbymichael.com/) ???ß⁄???? [Dockerfiles best practices](http://crosbymichael.com/dockerfile-best-practices.html) / [take 2](http://crosbymichael.com/dockerfile-best-practices-take-2.html)
- [Building Good Docker Images](http://jonathan.bergknoff.com/journal/building-good-docker-images) / [Building Better Docker Images](http://jonathan.bergknoff.com/journal/building-better-docker-images)
- [Managing Container Configuration with Metadata](https://speakerdeck.com/garethr/managing-container-configuration-with-metadata)

## ??(Layers)

Docker ??∑⁄??????????????????? [Git ??????????????](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/) ?????

## ????(Links)

???? (links) [??? TCP/IP ???](https://docs.docker.com/userguide/dockerlinks/) ??? Docker ????????????[Atlassian](https://blogs.atlassian.com/2013/11/docker-all-the-things-at-atlassian-automation-and-wiring/) ??????????????????? [????????? (hostname) ????](https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#/updating-the-etchosts-file)??

??????????????????????????? [?????????](https://docs.docker.com/network/) ???????

???: ???????????????**?**???????????????????? Docker ??????????????? `-icc=false` ?????????????????

?????????????? CONTAINER ??????????? `docker run --name CONTAINER` ??????????? Dockerfile ?ßµ????????????:

```
EXPOSE 1337
```

???????????????????? LINKED ??????:

```
docker run -d --link CONTAINER:ALIAS --name LINKED user/wordpress
```

??? CONTAINER ??????????????????????????????????? LINKED ??:

```
$ALIAS_PORT_1337_TCP_PORT
$ALIAS_PORT_1337_TCP_ADDR
```

?????????????????????????????

??? `docker rm --link` ????????????

?????Docker ????????????????????????????????????????????????????????????????ß’?????? Docker??????????????????????[The Docker Ecosystem: Service Discovery and Distributed Configuration Stores](https://www.digitalocean.com/community/tutorials/the-docker-ecosystem-service-discovery-and-distributed-configuration-stores) ????????????

## ???(Volumes)

Docker ???? (volumes) ?? [???????????](https://docs.docker.com/engine/tutorials/dockervolumes/)?????????????????????????????

### ????????

- [`docker volume create`](https://docs.docker.com/engine/reference/commandline/volume_create/)
- [`docker volume rm`](https://docs.docker.com/engine/reference/commandline/volume_rm/)

### ???

- [`docker volume ls`](https://docs.docker.com/engine/reference/commandline/volume_ls/)
- [`docker volume inspect`](https://docs.docker.com/engine/reference/commandline/volume_inspect/)

??????????????????? TCP/IP????????°§?????®¢????Ì‡??????????? Docker ???????????????????????????

???????????????????? docker ?????????? `docker run --volumes-from`??

?????????????????????????????????õ•???????????????????????????????????????????????????????????ß÷?????????????????????????????????¶¡????????????ß≥?

?? [??????](http://crosbymichael.com/advanced-docker-volumes.html) ?????????????[Container42](http://container42.com/2014/11/03/docker-indepth-volumes/) ??????®¢?

????? [?????? MacOS ??????????? Docker ???](https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-directory-as-a-data-volume)??

```
docker run -v /Users/wsargent/myapp/src:/src
```

???????????? NFS ????????????? [????????](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume)??

?????????????????????????????? [????](http://container42.com/2013/12/16/persistent-volumes-with-docker-container-as-volume-pattern/) ???????????????????????

????[?????????????????](#?????????????)??

## ??????(Exposing ports)

?????????????????????? [????????ßπ??](https://docs.docker.com/engine/reference/run/#expose-incoming-ports)??

??????? `-p` ????????????????????????????????? (localhost) ??????

```
docker run -p 127.0.0.1:$HOSTPORT:$CONTAINERPORT --name CONTAINER -t someimage
```

???????? [EXPOSE](https://docs.docker.com/engine/reference/builder/#expose) ??? Docker???????????????????????????

```
EXPOSE <CONTAINERPORT>
```

??????? EXPOSE ?????????????????????®∞??? `-p` ???????????? localhost ????????????:

```
iptables -t nat -A DOCKER -p tcp --dport <LOCALHOSTPORT> -j DNAT --to-destination <CONTAINERIP>:<PORT>
```

????????? Virtualbox ?????? Docker??????????????????? (forward the port)????? [forwarded_port](https://docs.vagrantup.com/v2/networking/forwarded_ports.html) ?? Vagrantfile ?????????????¶∂??????????????????????

```
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  ...

  (49000..49900).each do |port|
    config.vm.network :forwarded_port, :host => port, :guest => port
  end

  ...
end
```

????????????????????????????????????? `docker port` ????

```
docker port CONTAINER $CONTAINERPORT
```

## ??????

???????ßª??????????????????

- [The Rabbit Hole of Using Docker in Automated Tests](http://gregoryszorc.com/blog/2014/10/16/the-rabbit-hole-of-using-docker-in-automated-tests/)
- [Bridget Kromhout](https://twitter.com/bridgetkromhout) has a useful blog post on [running Docker in production](http://sysadvent.blogspot.co.uk/2014/12/day-1-docker-in-production-reality-not.html) at Dramafever.
- There's also a best practices [blog post](http://developers.lyst.com/devops/2014/12/08/docker/) from Lyst.
- [A Docker Dev Environment in 24 Hours!](https://engineering.salesforceiq.com/2013/11/05/a-docker-dev-environment-in-24-hours-part-2-of-2.html)
- [Building a Development Environment With Docker](https://tersesystems.com/2013/11/20/building-a-development-environment-with-docker/)
- [Discourse in a Docker Container](https://samsaffron.com/archive/2013/11/07/discourse-in-a-docker-container)

## ???(Security)

???????????ßª???? Docker ??????????Docker ?????? [???](https://docs.docker.com/articles/security/) ??‰˚???????????

???????????Docker ???? root ???????????? `docker` ?ÔÖ???????? [root ???](https://web.archive.org/web/20161226211755/http://reventlov.com/advisories/using-the-docker-command-to-root-the-host)??????? Docker ?? Unix Socket ?????????????¶∆???????????? [?????? root ???](https://www.lvh.io/posts/dont-expose-the-docker-socket-not-even-to-a-container.html)??

Docker ????????¶∑?????????????????????????????

?????????????????????????????? [Aaron Grattafiori](https://twitter.com/dyn___) ??ß’?? [Understanding and Hardening Linux Containers](https://www.nccgroup.trust/globalassets/our-research/us/whitepapers/2016/april/ncc_group_understanding_hardening_linux_containers-1-1.pdf)????????????????????????????????????????????????????????????????????????????????????????????????????ß—????????????????????????

### ??????

?????????????????????????????????? Docker?????????? Docker ???????????????? -- [slides](http://www.slideshare.net/jpetazzo/linux-containers-lxc-docker-and-security) / [notes](http://www.projectatomic.io/blog/2014/08/is-it-safe-a-look-at-docker-and-security-from-linuxcon/)????????? AppArmor??seccomp??SELinux??grsec ???? [?????????????](http://linux-audit.com/docker-security-best-practices-for-your-vessel-and-containers/)??????????????? [Docker 1.10 security features](https://blog.docker.com/2016/02/docker-engine-1-10-security/)??

Docker ???? ID ???? [???????](https://medium.com/@quayio/your-docker-image-ids-are-secrets-and-its-time-you-treated-them-that-way-f55e9f14c1a4) ???????????????¿M????????????????????????

????? [Thomas Sj?gren](https://github.com/konstruktoid) ??ß’?? [Docker Security Cheat Sheet](https://github.com/konstruktoid/Docker/blob/master/Security/CheatSheet.adoc)????????????????????Óï

?? [Docker ?????????](https://github.com/docker/docker-bench-security)?????? [???????????](https://blog.docker.com/2015/05/understanding-docker-security-and-best-practices/)??

??????????°¬?????∑⁄ grsecurity / pax ?????????? [Alpine Linux](https://en.wikipedia.org/wiki/Alpine_Linux)??????????????? grsecurity?????????????????? [??????](https://grsecurity.net/business_support.php) ?? [????∑⁄](https://grsecurity.net/announce.php)?????????? RedHat ?????????? \$200 ????????????????????????????

?? Docker 1.11 ??????????????????????????ß·??????????????? fork ????? ????? Linux ??? >= 4.3?????????????????ß’? CGROUP_PIDS=y??

```
docker run --pids-limit=64
```

?????????????????????????????®¥????? Linux ???? 3.5 ?∑⁄???????ß÷???????? [???????](http://www.projectatomic.io/blog/2016/03/no-new-privs-docker/) ????????????????????????

```
docker run --security-opt=no-new-privileges
```

???????????? [Container Solutions](http://container-solutions.com/is-docker-safe-for-production/) ?? [Docker Security Cheat Sheet](http://container-solutions.com/content/uploads/2015/06/15.06.15_DockerCheatSheet_A2.pdf)??PDF ?∑⁄??????????????????????

??????????????

```
docker -d --icc=false --iptables
```

??????????????

```
docker run --read-only
```

??? hashsum ????????

```
docker pull debian@sha256:a25306f3850e1bd44541976aa7b5fd0a29be
```

????????????

```
docker run -v $(pwd)/secrets:/secrets:ro debian
```

?? Dockerfile ?ßÿ?????????????????ßµ??????????????? ROOT ????????

```
RUN groupadd -r user && useradd -r -g user user
USER user
```

### ??????????(User Namespaces)

???????????? [??????????](https://s3hh.wordpress.com/2013/07/19/creating-and-using-containers-without-privilege/) -- ?? 1.10 ?∑⁄???????????????¶ƒ???®¢?

??? Ubuntu 15.10 ???????????????? (remap the userns)???? [????????????????](https://raesene.github.io/blog/2016/02/04/Docker-User-Namespaces/) ??????

### ?????????

- [Using Docker Safely](https://youtu.be/04LOuMgNj9U)
- [Securing your applications using Docker](https://youtu.be/KmxOXmPhZbk)
- [Container security: Do containers actually contain?](https://youtu.be/a9lE9Urr6AQ)
- [Linux Containers: Future or Fantasy?](https://www.youtube.com/watch?v=iN6QbszB1R8)

### ???°§???

Docker ??°§????????? [seccomp ?????](https://github.com/docker/docker/blob/master/ROADMAP.md#11-security)??
?????? [bane](https://github.com/jfrazelle/bane) ?? AppArmor ????????????????? [??????????](https://github.com/docker/docker/issues/17142)??

## ß≥???

?????

- [15 Docker Tips in 5 minutes](http://sssslide.com/speakerdeck.com/bmorearty/15-docker-tips-in-5-minutes)
- [CodeFresh Everyday Hacks Docker](https://codefresh.io/blog/everyday-hacks-docker/)

### ????

????? [???????????](https://github.com/docker/docker/pull/26108) ???? Docker 1.13 ????

- `docker system prune`
- `docker volume prune`
- `docker network prune`
- `docker container prune`
- `docker image prune`

### df ????

`docker system df` ???????? Docker ???????????????

### Heredoc ???? Docker ????

```
docker build -t htop - << EOF
FROM alpine
RUN apk --no-cache add htop
EOF
```

### ?????¶≈????? ID

```
alias dl='docker ps -l -q'
docker run ubuntu echo hello world
docker commit $(dl) helloworld
```

### ?????????????? Dockerfile??

```
docker commit -run='{"Cmd":["postgres", "-too -many -opts"]}' $(dl) postgres
```

### ??? IP ???

```
docker inspect $(dl) | grep -wm1 IPAddress | cut -d '"' -f 4
```

????? [jq](https://stedolan.github.io/jq/):

```
docker inspect $(dl) | jq -r '.[0].NetworkSettings.IPAddress'
```

????? [go ???](https://docs.docker.com/engine/reference/commandline/inspect)??

```
docker inspect -f '{{ .NetworkSettings.IPAddress }}' <container_name>
```

??????? Dockerfile ?????????????????????? (build argument) ????

```
DOCKER_HOST_IP=`ifconfig | grep -E "([0-9]{1,3}\.){3}[0-9]{1,3}" | grep -v 127.0.0.1 | awk '{ print $2 }' | cut -f2 -d: | head -n1`
echo DOCKER_HOST_IP = $DOCKER_HOST_IP
docker build \
  --build-arg ARTIFACTORY_ADDRESS=$DOCKER_HOST_IP
  -t sometag \
  some-directory/
```

### ?????????

```
docker inspect -f '{{range $p, $conf := .NetworkSettings.Ports}} {{$p}} -> {{(index $conf 0).HostPort}} {{end}}' <containername>
```

### ??????????????

```
for i in $(docker ps -a | grep "REGEXP_PATTERN" | cut -f1 -d" "); do echo $i; done`
```

### ???????????????

```
docker run --rm ubuntu env
```

### ???????????ß÷?????

```
docker kill $(docker ps -q)
```

### ????????????????????????????????ß›?????

```
docker rm -f $(docker ps -qa)
```

### ?????????

```
docker ps -a | grep 'weeks ago' | awk '{print $1}' | xargs docker rm
```

### ?????????????

```
docker rm -v `docker ps -a -q -f status=exited`
```

### ???????????

```
docker stop $(docker ps -aq) && docker rm -v $(docker ps -aq)
```

### ??????? (dangling) ?????

```
docker rmi $(docker images -q -f dangling=true)
```

### ??????ß‡???

```
docker rmi $(docker images -q)
```

### ??????? (dangling) ????

Docker 1.9 ?∑⁄??

```
docker volume rm $(docker volume ls -q -f dangling=true)
```

1.9.0 ?ßµ????? `dangling=false` ??? _?_ ?? - ????????????ß‘????ß÷???

### ??????????

```
docker images -viz | dot -Tpng -o docker.png
```

### Docker ????????

- ????? (RUN layer) ???? APT

??????????? apt ??????????????®¿?
???????????????????????????????????????

```
RUN {apt commands} \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
```

- ???????

```
ID=$(docker run -d image-name /bin/bash)
docker export $ID | docker import ?C flat-image-name
```

- ????

```
ID=$(docker run -d image-name /bin/bash)
(docker export $ID | gzip -c > image.tgz)
gzip -dc image.tgz | docker import - flat-image-name
```

### ???????????????????????????

???????????? CPU???????????? I/O ??????????????

```
docker stats <container>
```

?? ID ?ß‘???????????

```
docker stats $(docker ps -q)
```

???????ß‘???????????

```
docker stats $(docker ps --format '{{.Names}}')
```

??????????????ß‘???????????

```
docker ps -a -f ancestor=ubuntu
```

???????¶ƒ??????? (untagged) ????????

```
docker rmi $(docker images | grep ??^?? | awk '{split($0,a," "); print a[3]}')
```

??????????????????????

```
docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f
```

???????????? (exited) ????????

```
docker rm -f $(docker ps -a | grep Exit | awk '{ print $1 }')
```

### ?????????????

???????????????????????????????????????????

```bash
# ?????????????
docker run --rm httpd cat /usr/local/apache2/conf/httpd.conf > httpd.conf

# ?????
vim httpd.conf

# ?????????????????????
docker run --rm -ti -v "$PWD/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro" -p "80:80" httpd
```

## ?¶œ?????

- [Docker Cheat Sheet](https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn)
